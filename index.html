<script>
  let startTime;
  let interval;
  let izinStarted = false;

  function formatMenitDetik(totalDetik) {
    const menit = Math.floor(totalDetik / 60);
    const detik = totalDetik % 60;
    return `${menit} menit ${detik} detik`;
  }

  function mulaiIzin() {
    if (!izinStarted) {
      izinStarted = true;
      startTime = Date.now();

      interval = setInterval(() => {
        const now = Date.now();
        const elapsed = Math.floor((now - startTime) / 1000);
        document.getElementById("waktuBerjalan").innerText = formatMenitDetik(elapsed);

        if (elapsed > 960) {
          alert("⚠️ Anda telah melewati batas izin 16 menit!");
          clearInterval(interval);
          izinStarted = false;
          document.getElementById("waktuBerjalan").innerText = `0 menit 0 detik`;
        }
      }, 1000);
    }
  }

  function selesaiIzin() {
    if (izinStarted) {
      izinStarted = false;
      clearInterval(interval);

      const endTime = Date.now();
      const durasi = Math.floor((endTime - startTime) / 1000);

      document.getElementById("durasiIzin").innerText = formatMenitDetik(durasi);
      document.getElementById("waktuBerjalan").innerText = `0 menit 0 detik`;

      const data = {
        nama: document.getElementById("nama").value,
        jenisIzin: document.getElementById("izin").value,
        durasi: formatMenitDetik(durasi)
      };

      fetch("PASTE_LINK_WEBAPP_DI_SINI", {
        method: "POST",
        body: JSON.stringify(data),
        headers: {
          "Content-Type": "application/json",
        }
      })
      .then(res => res.json())
      .then(response => {
        alert("Data berhasil dikirim!");
      })
      .catch(error => {
        alert("Gagal mengirim data!");
        console.error(error);
      });
    }
  }
</script>
